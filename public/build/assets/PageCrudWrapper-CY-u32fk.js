import{r as g,j as a}from"./ui-C9UzXxo-.js";import{P as me}from"./page-template-B2HXPu-s.js";import{u as fe,K as ue,v as V,P as he,a9 as K,I as je,B as U,L as R,S as f,t as o}from"./app-CePVSpCk.js";import{S as L,a as H,b as W,c as q,d as v}from"./select-79vLaRYu.js";import{P as ge}from"./pagination-ByvlncqM.js";import{C as xe}from"./CrudTable-Dqp1N8Wk.js";import{C as be}from"./CrudFormModal-BxbeyOXE.js";import{C as Se}from"./CrudDeleteModal-CqSiuuPI.js";import{F as ve}from"./filter-CJHBgxPm.js";function $e({config:y,title:G,url:J,buttons:D=[],breadcrumbs:Q}){var I;const{t:n}=fe(),{entity:i,table:F,filters:S=[],form:C,hooks:c}=y,{auth:w,...M}=ue().props,N=(w==null?void 0:w.permissions)||[],b=M[i.name]||{data:[],links:[]},p=M.filters||{},[m,T]=g.useState(p.search||""),[x,O]=g.useState({}),[_,k]=g.useState(!1),[X,h]=g.useState(!1),[Y,A]=g.useState(!1),[j,z]=g.useState(null),[u,E]=g.useState("create");g.useEffect(()=>{const e={};S.forEach(s=>{const l=s.name||s.key;e[l]=p[l]||""}),O(e)},[]);const $=()=>Object.entries(x).some(([e,s])=>s&&s!=="")||m!=="",Z=()=>Object.entries(x).filter(([e,s])=>s&&s!=="").length+(m?1:0),ee=e=>{e.preventDefault(),se()},se=()=>{const e={page:1};m&&(e.search=m),Object.entries(x).forEach(([s,l])=>{l&&l!==""&&(e[s]=l)}),p.per_page&&(e.per_page=p.per_page),f.get(i.endpoint,e,{preserveState:!0,preserveScroll:!0})},re=(e,s)=>{O(d=>({...d,[e]:s}));const l={page:1};m&&(l.search=m);const t={...x,[e]:s};Object.entries(t).forEach(([d,r])=>{r&&r!==""&&(l[d]=r)}),p.per_page&&(l.per_page=p.per_page),f.get(i.endpoint,l,{preserveState:!0,preserveScroll:!0})},te=e=>{const s=p.sort_field===e&&p.sort_direction==="asc"?"desc":"asc",l={sort_field:e,sort_direction:s,page:1};m&&(l.search=m),Object.entries(x).forEach(([t,d])=>{d&&d!==""&&(l[t]=d)}),p.per_page&&(l.per_page=p.per_page),f.get(i.endpoint,l,{preserveState:!0,preserveScroll:!0})},ae=(e,s)=>{switch(z(s),e){case"view":E("view"),h(!0);break;case"edit":E("edit"),h(!0);break;case"delete":A(!0);break}},ie=()=>{z(null),E("create"),h(!0)},oe=e=>{const s={...e};if(i.name==="roles"){if(s.permissions&&Array.isArray(s.permissions)){const d=s.permissions.map(r=>typeof r=="object"&&r!==null&&r.name?r.name:String(r));s.permissions=d}const t={label:s.label,description:s.description||"",permissions:s.permissions||[]};Object.keys(s).forEach(d=>{delete s[d]}),Object.assign(s,t)}else if(s.permissions&&Array.isArray(s.permissions)){const t={};s.permissions.forEach((d,r)=>{t[r]=String(d)}),s.permissions=t}if(i.name==="permissions"&&u==="edit"&&delete s.name,C.fields.some(t=>t.type==="file")){const t=C.fields.filter(r=>r.type==="file").map(r=>r.name),d=new FormData;Object.keys(s).forEach(r=>{if(t.includes(r)&&u==="edit"){s[r]&&typeof s[r]=="object"&&d.append(r,s[r]);return}d.append(r,s[r])}),u==="create"?(o.loading(n("Creating...")),f.post(i.endpoint,d,{onSuccess:r=>{h(!1),o.dismiss(),r.props.flash.success?o.success(n(r.props.flash.success)):r.props.flash.error&&o.error(n(r.props.flash.error)),c!=null&&c.afterCreate&&c.afterCreate(e,r.props[i.name])},onError:r=>{o.dismiss(),typeof r=="string"?o.error(n(r)):o.error(n(`Failed to create ${i.name.slice(0,-1)}: {{errors}}`,{errors:Object.values(r).join(", ")}))}})):u==="edit"&&(o.loading(n("Updating...")),f.post(`${i.endpoint}/${j.id}?_method=PUT`,d,{onSuccess:r=>{h(!1),o.dismiss(),r.props.flash.success?o.success(n(r.props.flash.success)):r.props.flash.error&&o.error(n(r.props.flash.error)),c!=null&&c.afterUpdate&&c.afterUpdate(e,r.props[i.name])},onError:r=>{o.dismiss(),typeof r=="string"?o.error(n(r)):o.error(n(`Failed to update ${i.name.slice(0,-1)}: {{errors}}`,{errors:Object.values(r).join(", ")}))}}));return}u==="create"?(o.loading(n("Creating...")),f.post(i.endpoint,s,{onSuccess:t=>{h(!1),o.dismiss(),t.props.flash.success?o.success(n(t.props.flash.success)):t.props.flash.error&&o.error(n(t.props.flash.error)),c!=null&&c.afterCreate&&c.afterCreate(e,t.props[i.name])},onError:t=>{o.dismiss(),typeof t=="string"?o.error(n(t)):o.error(n(`Failed to create ${i.name.slice(0,-1)}: {{errors}}`,{errors:Object.values(t).join(", ")}))}})):u==="edit"&&(o.loading(n("Updating...")),f.put(`${i.endpoint}/${j.id}`,s,{onSuccess:t=>{h(!1),o.dismiss(),t.props.flash.success?o.success(n(t.props.flash.success)):t.props.flash.error&&o.error(n(t.props.flash.error)),c!=null&&c.afterUpdate&&c.afterUpdate(e,t.props[i.name])},onError:t=>{o.dismiss(),typeof t=="string"?o.error(n(t)):o.error(n(`Failed to update ${i.name.slice(0,-1)}: {{errors}}`,{errors:Object.values(t).join(", ")}))}}))},ne=()=>{o.loading(n("Deleting...")),f.delete(`${i.endpoint}/${j.id}`,{onSuccess:e=>{A(!1),o.dismiss(),e.props.flash.success?o.success(n(e.props.flash.success)):e.props.flash.error&&o.error(n(e.props.flash.error)),c!=null&&c.afterDelete&&c.afterDelete(j.id)},onError:e=>{o.dismiss(),typeof e=="string"?o.error(n(e)):o.error(n(`Failed to delete ${i.name.slice(0,-1)}: {{errors}}`,{errors:Object.values(e).join(", ")}))}})},le=()=>{const e={};S.forEach(s=>{e[s.key]=s.type==="select"?"all":""}),O(e),T(""),k(!1),f.get(i.endpoint,{page:1,per_page:p.per_page},{preserveState:!0,preserveScroll:!0})},ce=D.every(e=>e.showAddButton!==!1),P=[];D.forEach(e=>{(!e.permission||V(N,e.permission))&&P.push({label:e.label,icon:e.icon,variant:e.variant,onClick:e.onClick})}),ce&&V(N,i.permissions.create)&&P.push({label:`Add New ${i.name.slice(0,-1).charAt(0).toUpperCase()+i.name.slice(0,-1).slice(1)}`,icon:a.jsx(he,{className:"h-4 w-4"}),variant:"default",onClick:()=>ie()});const B=G||i.name.charAt(0).toUpperCase()+i.name.slice(1),de=[{title:n("Dashboard"),href:route("dashboard")},{title:B}],pe=Q||de;return a.jsxs(me,{title:B,url:J,actions:P,breadcrumbs:pe,noPadding:!0,children:[a.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow mb-4",children:a.jsxs("div",{className:"p-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("form",{onSubmit:ee,className:"flex gap-2",children:[a.jsxs("div",{className:"relative w-64",children:[a.jsx(K,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),a.jsx(je,{placeholder:`Search ${i.name}...`,value:m,onChange:e=>T(e.target.value),className:"w-full pl-9"})]}),a.jsxs(U,{type:"submit",size:"sm",children:[a.jsx(K,{className:"h-4 w-4 mr-1.5"}),n("Search")]})]}),S.length>0&&a.jsx("div",{className:"ml-2",children:a.jsxs(U,{variant:$()?"default":"outline",size:"sm",className:"h-8 px-2 py-1",onClick:()=>k(!_),children:[a.jsx(ve,{className:"h-3.5 w-3.5 mr-1.5"}),_?"Hide Filters":"Filters",$()&&a.jsx("span",{className:"ml-1 bg-primary-foreground text-primary rounded-full w-5 h-5 flex items-center justify-center text-xs",children:Z()})]})})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(R,{className:"text-xs text-muted-foreground",children:[n("Per Page"),":"]}),a.jsxs(L,{value:((I=p.per_page)==null?void 0:I.toString())||"10",onValueChange:e=>{const s={page:1,per_page:parseInt(e)};m&&(s.search=m),Object.entries(x).forEach(([l,t])=>{t&&t!==""&&(s[l]=t)}),f.get(i.endpoint,s,{preserveState:!0,preserveScroll:!0})},children:[a.jsx(H,{className:"w-16 h-8",children:a.jsx(W,{})}),a.jsxs(q,{children:[a.jsx(v,{value:"10",children:"10"}),a.jsx(v,{value:"25",children:"25"}),a.jsx(v,{value:"50",children:"50"}),a.jsx(v,{value:"100",children:"100"})]})]})]})]}),_&&S.length>0&&a.jsx("div",{className:"w-full mt-3 p-4 bg-gray-50 dark:bg-gray-800 border dark:border-gray-700 rounded-md",children:a.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[S.map(e=>{var l;const s=e.name||e.key;return a.jsxs("div",{className:"space-y-2",children:[a.jsx(R,{children:e.label}),e.type==="select"&&a.jsxs(L,{value:x[s]||"",onValueChange:t=>re(s,t),children:[a.jsx(H,{className:"w-40",children:a.jsx(W,{placeholder:`All ${e.label}`})}),a.jsx(q,{children:(l=e.options)==null?void 0:l.map(t=>a.jsx(v,{value:t.value,children:t.label},t.value))})]})]},s)}),a.jsx(U,{variant:"outline",size:"sm",className:"h-9",onClick:le,disabled:!$(),children:n("Reset Filters")})]})})]})}),a.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow overflow-hidden",children:[a.jsx(xe,{columns:F.columns,actions:F.actions,data:b.data,from:b.from||1,onAction:ae,sortField:p.sort_field,sortDirection:p.sort_direction,onSort:te,statusColors:F.statusColors,permissions:N,entityPermissions:i.permissions}),a.jsx(ge,{from:b.from||0,to:b.to||0,total:b.total,links:b.links,entityName:i.name,onPageChange:e=>f.get(e)})]}),a.jsx(be,{isOpen:X,onClose:()=>h(!1),onSubmit:oe,formConfig:{...C,modalSize:y.modalSize||C.modalSize},initialData:j,title:u==="create"?`Add New ${i.name.slice(0,-1).charAt(0).toUpperCase()+i.name.slice(0,-1).slice(1)}`:u==="edit"?`Edit ${i.name.slice(0,-1).charAt(0).toUpperCase()+i.name.slice(0,-1).slice(1)}`:`View ${i.name.slice(0,-1).charAt(0).toUpperCase()+i.name.slice(0,-1).slice(1)}`,mode:u,description:y.description}),a.jsx(Se,{isOpen:Y,onClose:()=>A(!1),onConfirm:ne,itemName:(j==null?void 0:j.name)||"",entityName:i.name.slice(0,-1)})]})}export{$e as P};
