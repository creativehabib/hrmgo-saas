import{r as N,j as a}from"./ui-C9UzXxo-.js";import{i as ae,X as ne,K as te,u as se,D as re,e as ce,f as oe,h as le,j as me,L as I,k as ie,B as K,I as R,M as ue}from"./app-CePVSpCk.js";import{T as pe}from"./textarea-CiZFgYfM.js";import{S as xe,a as de,b as he,c as ge,d as Q}from"./select-79vLaRYu.js";import{R as ye,a as je}from"./radio-group-DixjSev-.js";import{C as be}from"./checkbox-DdUGEdGf.js";import{S as ve}from"./switch-BT9_4soN.js";import{S as we}from"./scroll-area-B6c1Z5Wm.js";function Se({options:p,selected:j,onChange:F,placeholder:x="Select options",className:h}){const[C,i]=N.useState(!1),[O,V]=N.useState(""),g=N.useRef(null);N.useEffect(()=>{function r(o){g.current&&!g.current.contains(o.target)&&i(!1)}return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[]);const t=r=>{j.includes(r)||F([...j,r]),V(""),setTimeout(()=>{var v;const o=(v=g.current)==null?void 0:v.querySelector("input");o&&o.focus()},10)},u=r=>{F(j.filter(o=>o!==r))},s=p.filter(r=>(O||!j.includes(r.value))&&r.label.toLowerCase().includes(O.toLowerCase()));return a.jsxs("div",{ref:g,className:`relative ${h}`,children:[a.jsxs("div",{className:"flex flex-wrap gap-1 p-2 border rounded-md min-h-[38px] cursor-text",onClick:()=>i(!0),children:[j.map(r=>{const o=p.find(v=>v.value===r);return a.jsxs(ae,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[(o==null?void 0:o.label)||r,a.jsx("button",{type:"button",className:"ml-1 rounded-sm",onClick:v=>{v.stopPropagation(),u(r)},children:a.jsx(ne,{className:"h-3 w-3 text-muted-foreground hover:text-foreground"})})]},r)}),a.jsx("input",{type:"text",value:O,onChange:r=>V(r.target.value),onFocus:()=>i(!0),placeholder:j.length===0?x:"",className:"flex-1 outline-none bg-transparent min-w-[50px]"})]}),C&&s.length>0&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border rounded-md shadow-lg max-h-[200px] overflow-y-auto",children:s.map(r=>a.jsx("div",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100",onClick:()=>{t(r.value),i(!0)},children:r.label},r.value))})]})}function Ne({field:p,formData:j,handleChange:F}){const x=Array.isArray(j[p.name])?j[p.name]:j[p.name]?[j[p.name].toString()]:[];return a.jsx(Se,{options:p.options||[],selected:x,onChange:h=>F(p.name,h),placeholder:p.placeholder||`Select ${p.label}`})}function Fe({fields:p,values:j,onChange:F,disabled:x=!1}){const{base_url:h}=te().props,[C,i]=N.useState(()=>{const u={};return p.forEach((s,r)=>{r===0?u[s.name]=s.options||[]:u[s.name]=[]}),u}),[O,V]=N.useState({}),g=async(u,s)=>{var r;if(!u.apiEndpoint)return[];V(o=>({...o,[u.name]:!0}));try{let o=u.apiEndpoint;if(s){const d=encodeURIComponent(String(s)),b=(r=p[p.indexOf(u)-1])==null?void 0:r.name;b&&(o=o.replace(`{${b}}`,d))}const v=await fetch(`${h}${o}`);if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);const w=await v.json();return Array.isArray(w)?w.map(d=>({value:String(d.id||d.value||""),label:String(d.name||d.label||"Unknown")})):[]}catch{return[]}finally{V(o=>({...o,[u.name]:!1}))}};N.useEffect(()=>{(async()=>{const s={};for(let r=0;r<p.length;r++){const o=p[r];if(r===0)o.apiEndpoint?s[o.name]=await g(o):s[o.name]=o.options||[];else{const v=p[r-1],w=j[v.name];w?o.apiEndpoint?s[o.name]=await g(o,w):o.dependencies?s[o.name]=o.dependencies[w]||[]:s[o.name]=[]:s[o.name]=[]}}i(s)})()},[p]);const t=async(u,s,r)=>{p.slice(r+1).forEach(b=>{F(b.name,"")});const o=p.find(b=>b.name===u),w=(C[u]||(o==null?void 0:o.options)||[]).find(b=>String(b.value)===String(s)),y=w?{id:s,name:w.label}:null,d=p[r+1];if(d&&s){if(d.apiEndpoint){const b=await g(d,s);i(k=>({...k,[d.name]:b})),F(u,s,{selectedInfo:y,loadedOptions:b});return}else if(d.dependencies){const b=d.dependencies[s]||[];i(k=>({...k,[d.name]:b})),F(u,s,{selectedInfo:y,loadedOptions:b});return}}F(u,s,{selectedInfo:y,loadedOptions:[]})};return a.jsx("div",{className:"space-y-4",children:p.map((u,s)=>{const r=s===0,o=r?null:p[s-1],v=x||!r&&!j[o.name],w=C[u.name]||[],y=O[u.name];return a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:u.label}),a.jsxs("select",{value:j[u.name]||"",onChange:d=>t(u.name,d.target.value,s),disabled:v||y,className:"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[a.jsx("option",{value:"",className:"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none text-muted-foreground",children:y?"Loading...":`Select ${u.label.toLowerCase()}`}),w.map(d=>a.jsx("option",{value:d.value,className:"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",children:d.label},d.value))]})]},u.name)})})}function ke({isOpen:p,onClose:j,onSubmit:F,formConfig:x,initialData:h={},title:C,mode:i,description:O,errors:V={}}){const{t:g}=se(),[t,u]=N.useState({}),[s,r]=N.useState({}),[o,v]=N.useState({}),w=()=>{if(!x.priceSummary)return 0;const e=t[x.priceSummary.quantityFieldName||"quantity"]||x.priceSummary.quantity||1;return x.priceSummary.unitPrice*e};N.useEffect(()=>{if(p){const e={...h};x.fields.forEach(m=>{m.type==="multi-select"&&e[m.name]&&!Array.isArray(e[m.name])&&(e[m.name]=Array.isArray(e[m.name])?e[m.name]:e[m.name]?[e[m.name].toString()]:[]),i==="create"&&(e[m.name]===void 0||e[m.name]===null)&&m.defaultValue!==void 0&&(e[m.name]=m.defaultValue)}),u(e||{}),r({}),x.fields.forEach(m=>{m.relation&&m.relation.endpoint&&fetch(m.relation.endpoint).then(c=>c.json()).then(c=>{v(S=>({...S,[m.name]:Array.isArray(c)?c:c.data||[]}))}).catch(c=>{})})}},[p,h,x.fields,i]),N.useEffect(()=>{if(V&&Object.keys(V).length>0){const e={};Object.entries(V).forEach(([m,c])=>{e[m]=Array.isArray(c)?c[0]:c}),r(e)}},[V]);const y=(e,m)=>{u(c=>({...c,[e]:m})),s[e]&&r(c=>{const S={...c};return delete S[e],S})},d=e=>{e.preventDefault();const m={...t};x.fields.forEach(l=>{l.type==="multi-select"&&m[l.name]&&(Array.isArray(m[l.name])||(m[l.name]=[m[l.name].toString()]))}),u(m);const c={};if(x.fields.forEach(l=>{if(l.type==="file"&&i==="edit")return;const z=l.conditional?l.conditional(i,t):!0;if(l.required&&z&&!t[l.name]&&(c[l.name]=`${l.label} is required`),l.type==="file"&&t[l.name]&&l.fileValidation){const A=t[l.name];if(l.fileValidation.maxSize&&A.size>l.fileValidation.maxSize){const E=l.fileValidation.maxSize/1048576;c[l.name]=`File size must be less than ${E}MB`}if(l.fileValidation.mimeTypes&&l.fileValidation.mimeTypes.length>0&&(l.fileValidation.mimeTypes.includes(A.type)||(c[l.name]=`File type must be one of: ${l.fileValidation.mimeTypes.join(", ")}`)),l.fileValidation.extensions&&l.fileValidation.extensions.length>0){const E=A.name,$=E.substring(E.lastIndexOf(".")).toLowerCase();l.fileValidation.extensions.includes($)||(c[l.name]=`File extension must be one of: ${l.fileValidation.extensions.join(", ")}`)}}}),Object.keys(c).length>0){r(c);return}const S={...t};x.fields.forEach(l=>{l.type==="multi-select"&&S[l.name]&&(Array.isArray(S[l.name])||(S[l.name]=[S[l.name].toString()]))}),F(S)},b=e=>{var m,c,S,l,z,A;if(e.conditional&&!e.conditional(i,t))return null;if(e.render)return e.render(e,t,y);if(i==="view"){if(e.type==="multi-select"){const $=(Array.isArray(t[e.name])?t[e.name]:[]).map(T=>{var L;const q=(L=e.options)==null?void 0:L.find(M=>M.value===T);return q?q.label:T}).join(", ");return a.jsx("div",{className:"p-2 border rounded-md bg-gray-50",children:$||"-"})}return a.jsx("div",{className:"p-2 border rounded-md bg-gray-50",children:e.type==="select"&&e.options?((m=e.options.find(E=>E.value===String(t[e.name])))==null?void 0:m.label)||t[e.name]||"-":e.type==="checkbox"?t[e.name]===!0||t[e.name]===1||t[e.name]==="1"?g("Yes"):g("No"):t[e.name]||"-"})}switch(e.type){case"text":case"email":case"password":case"time":case"color":return a.jsx(R,{id:e.name,name:e.name,type:e.type,placeholder:e.placeholder,value:t[e.name]||"",onChange:n=>y(e.name,n.target.value),required:e.required,className:s[e.name]?"border-red-500":"",disabled:i==="view"});case"date":const E=t[e.name]?t[e.name]instanceof Date?t[e.name].toISOString().split("T")[0]:typeof t[e.name]=="string"&&t[e.name].includes("T")?t[e.name].split("T")[0]:t[e.name]:"";return a.jsx(R,{id:e.name,name:e.name,type:"date",placeholder:e.placeholder,value:E,onChange:n=>y(e.name,n.target.value),required:e.required,className:s[e.name]?"border-red-500":"",disabled:i==="view"});case"number":return a.jsx(R,{id:e.name,name:e.name,type:"number",placeholder:e.placeholder,value:t[e.name]||"",onChange:n=>y(e.name,n.target.value?parseFloat(n.target.value):""),required:e.required,className:s[e.name]?"border-red-500":"",disabled:i==="view"});case"textarea":return a.jsx(pe,{id:e.name,name:e.name,placeholder:e.placeholder,value:t[e.name]||"",onChange:n=>y(e.name,n.target.value),required:e.required,className:s[e.name]?"border-red-500":"",disabled:i==="view"});case"select":const $=e.relation?o[e.name]||[]:e.options||[],T=String(t[e.name]||""),q=e.relation?$.find(n=>String(n[e.relation.valueField])===T):$.find(n=>String(n.value)===T),L=q?e.relation?q[e.relation.labelField]:q.label:"";return a.jsxs(xe,{value:T,onValueChange:n=>y(e.name,n),disabled:i==="view",children:[a.jsx(de,{className:s[e.name]?"border-red-500":"",children:a.jsx(he,{placeholder:e.placeholder||`Select ${e.label}`,children:L||e.placeholder||`Select ${e.label}`})}),a.jsx(ge,{className:"z-[60000]",children:e.relation?$.map(n=>a.jsx(Q,{value:String(n[e.relation.valueField]),children:n[e.relation.labelField]},n[e.relation.valueField])):$.map(n=>a.jsx(Q,{value:String(n.value),children:n.label},n.value))})]});case"radio":return a.jsx(ye,{value:t[e.name]||"",onValueChange:n=>y(e.name,n),disabled:i==="view",className:"flex gap-4",children:(c=e.options)==null?void 0:c.map(n=>a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(je,{value:n.value,id:`${e.name}-${n.value}`}),a.jsx(I,{htmlFor:`${e.name}-${n.value}`,children:n.label})]},n.value))});case"checkbox":return a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(be,{id:e.name,checked:!!t[e.name],onCheckedChange:n=>y(e.name,n),disabled:i==="view"}),a.jsx(I,{htmlFor:e.name,children:e.placeholder||e.label})]});case"switch":return a.jsx(ve,{id:e.name,checked:!!t[e.name],onCheckedChange:n=>y(e.name,n),disabled:i==="view"});case"multi-select":return a.jsx(Ne,{field:e,formData:t,handleChange:y});case"media-picker":const M=t[e.name]||(i==="edit"&&h[e.name]?h[e.name].startsWith("http")?h[e.name]:`/storage/${h[e.name]}`:"");return a.jsx(ue,{value:M,onChange:n=>y(e.name,n),placeholder:e.placeholder||`Select ${e.label}`,showPreview:!0});case"file":const U=((S=e.fileValidation)==null?void 0:S.accept)||"",Z=U.includes("image")||(((z=(l=e.fileValidation)==null?void 0:l.mimeTypes)==null?void 0:z.some(n=>n.startsWith("image/")))??!1);return a.jsxs(a.Fragment,{children:[a.jsx(R,{id:e.name,name:e.name,type:"file",accept:U,onChange:n=>{n.target.files&&n.target.files[0]&&y(e.name,n.target.files[0])},className:s[e.name]?"border-red-500":"",disabled:i==="view"}),i==="edit"&&h[e.name]&&a.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Current file: ",h.featured_image_original_name||h[e.name]]}),e.fileValidation&&a.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e.fileValidation.extensions&&a.jsxs("span",{children:[g("Allowed extensions"),": ",e.fileValidation.extensions.join(", ")," "]}),e.fileValidation.maxSize&&a.jsxs("span",{children:[g("Max size"),": ",(e.fileValidation.maxSize/(1024*1024)).toFixed(1),"MB"]})]}),Z&&a.jsx("div",{className:"mt-2",children:t[e.name]&&t[e.name]instanceof File?a.jsxs("div",{className:"mt-2",children:[a.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:[g("Preview"),":"]}),a.jsx("img",{src:URL.createObjectURL(t[e.name]),alt:"Preview",className:"h-24 w-auto rounded-md object-cover shadow-sm"})]}):i==="edit"&&h[e.name]&&a.jsxs("div",{className:"mt-2",children:[a.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:[g("Current image"),":"]}),a.jsx("img",{src:typeof h[e.name]=="string"&&h[e.name].startsWith&&h[e.name].startsWith("http")?h[e.name]:`/storage/${h[e.name]}`,alt:"Current",className:"h-24 w-auto rounded-md object-cover shadow-sm",onError:n=>{n.currentTarget.src="https://placehold.co/200x150?text=Image+Not+Found"}})]})})]});case"dependent-dropdown":const D={};return(A=e.dependentConfig)==null||A.forEach(n=>{D[n.name]=t[n.name]||""}),a.jsx(Fe,{fields:e.dependentConfig||[],values:D,onChange:(n,W,f)=>{u(ee=>{var H;const _={...ee,[n]:W},G=((H=e.dependentConfig)==null?void 0:H.findIndex(P=>P.name===n))??-1;return G!==-1&&e.dependentConfig&&e.dependentConfig.slice(G+1).forEach(P=>{_[P.name]=""}),_}),e.onDependentChange&&e.onDependentChange(n,W,t,f)}});default:return null}},k=()=>{const e={sm:"sm:max-w-sm",md:"sm:max-w-md",lg:"sm:max-w-lg",xl:"sm:max-w-xl","2xl":"sm:max-w-2xl","3xl":"sm:max-w-3xl","4xl":"sm:max-w-4xl","5xl":"sm:max-w-5xl",full:"sm:max-w-full"};return x.modalSize?e[x.modalSize]:"sm:max-w-md"},X=()=>{const e={};return x.fields.forEach(m=>{const c=m.row||0;e[c]||(e[c]=[]),e[c].push(m)}),Object.entries(e).sort(([m],[c])=>parseInt(m)-parseInt(c))},B=x.layout||"default",Y=x.columns||1,J=`crud-modal-${i}-${C.replace(/\s+/g,"-").toLowerCase()}-${Date.now()}`;return a.jsx(re,{open:p,onOpenChange:j,children:a.jsxs(ce,{className:`${k()} max-h-[90vh]`,modalId:J,children:[a.jsxs(oe,{children:[a.jsx(le,{children:C}),a.jsx(me,{children:O||" "})]}),a.jsx(we,{className:"max-h-[70vh] pr-4",children:a.jsxs("form",{onSubmit:d,className:"space-y-4",children:[x.priceSummary&&a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-4",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsxs("span",{className:"text-sm text-gray-600",children:[g("Unit Price"),":"]}),a.jsxs("span",{className:"font-medium",children:["$",x.priceSummary.unitPrice.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsxs("span",{className:"text-sm text-gray-600",children:[g("Quantity"),":"]}),a.jsx("span",{className:"font-medium",children:t[x.priceSummary.quantityFieldName||"quantity"]||x.priceSummary.quantity||1})]}),a.jsx("div",{className:"border-t pt-2",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("span",{className:"font-semibold",children:[g("Total Price"),":"]}),a.jsxs("span",{className:"font-bold text-lg text-primary",children:["$",w().toFixed(2)]})]})})]}),B==="grid"?a.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(${Y}, 1fr)`,gap:"1rem"},children:x.fields.map(e=>e.conditional&&!e.conditional(i,t)?null:a.jsxs("div",{className:"space-y-2",style:{gridColumn:e.colSpan?`span ${e.colSpan}`:"span 1",width:"100%"},children:[a.jsxs(I,{htmlFor:e.name,className:"text-sm font-medium",children:[e.label," ",e.required&&!(e.type==="file"&&i==="edit")&&a.jsx("span",{className:"text-red-500",children:"*"})]}),b(e),s[e.name]&&a.jsx("p",{className:"text-xs text-red-500",children:s[e.name]})]},e.name))}):B==="flex"?a.jsx("div",{className:"flex flex-wrap gap-4",children:x.fields.map(e=>e.conditional&&!e.conditional(i,t)?null:a.jsxs("div",{className:"space-y-2",style:{width:e.width||"100%",flexGrow:e.width?0:1},children:[a.jsxs(I,{htmlFor:e.name,className:"text-sm font-medium",children:[e.label," ",e.required&&!(e.type==="file"&&i==="edit")&&a.jsx("span",{className:"text-red-500",children:"*"})]}),b(e),s[e.name]&&a.jsx("p",{className:"text-xs text-red-500",children:s[e.name]})]},e.name))}):X().map(([e,m])=>a.jsx("div",{className:"flex flex-wrap gap-4 mb-4",children:m.map(c=>c.conditional&&!c.conditional(i,t)?null:a.jsxs("div",{className:"space-y-2",style:{width:c.width||"100%"},children:[a.jsxs(I,{htmlFor:c.name,className:"text-sm font-medium",children:[c.label," ",c.required&&!(c.type==="file"&&i==="edit")&&a.jsx("span",{className:"text-red-500",children:"*"})]}),b(c),s[c.name]&&a.jsx("p",{className:"text-xs text-red-500",children:s[c.name]})]},c.name))},e))]})}),a.jsxs(ie,{className:"sm:justify-end",children:[a.jsx(K,{type:"button",variant:"outline",onClick:j,children:g("Cancel")}),i!=="view"&&a.jsx(K,{type:"button",onClick:d,children:g("Save")})]})]})})}export{ke as C};
