import{A as U,c as v,u as A,K as _,E as F,B as u,a as O,C as D,X as T,T as R,t as L}from"./app-CePVSpCk.js";import{j as e,t as G,v as P,w as B,x as H,I as J,y as q,G as K,L as V,U as X,r as j}from"./ui-C9UzXxo-.js";import{l as b,R as z}from"./language-BWaL1pXC.js";import{G as $}from"./globe-DIoyL4mD.js";import{S as W}from"./switch-BT9_4soN.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],le=U("LoaderCircle",Q);function Y({...t}){return e.jsx(G,{"data-slot":"dropdown-menu",...t})}function Z({...t}){return e.jsx(P,{"data-slot":"dropdown-menu-trigger",...t})}function ee({className:t,sideOffset:s=4,...c}){return e.jsx(B,{children:e.jsx(H,{"data-slot":"dropdown-menu-content",sideOffset:s,className:v("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] overflow-hidden rounded-md border p-1 shadow-md",t),...c})})}function te({...t}){return e.jsx(K,{"data-slot":"dropdown-menu-group",...t})}function M({className:t,inset:s,variant:c="default",...l}){return e.jsx(J,{"data-slot":"dropdown-menu-item","data-inset":s,"data-variant":c,className:v("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive-foreground data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/40 data-[variant=destructive]:focus:text-destructive-foreground data-[variant=destructive]:*:[svg]:!text-destructive-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...l})}function de({className:t,inset:s,...c}){return e.jsx(V,{"data-slot":"dropdown-menu-label","data-inset":s,className:v("px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",t),...c})}function se({className:t,...s}){return e.jsx(q,{"data-slot":"dropdown-menu-separator",className:v("bg-border -mx-1 my-1 h-px",t),...s})}const ue=()=>{var o,m;const{i18n:t}=A(),{auth:s}=_().props,c=X.useMemo(()=>b.find(i=>i.code===t.language)||b[0],[t.language]),l=s==null?void 0:s.user,k=((m=(o=s==null?void 0:s.user)==null?void 0:o.roles)==null?void 0:m.map(i=>i.name))||[],f=l&&F("superadmin",k);return e.jsxs(Y,{children:[e.jsx(Z,{asChild:!0,children:e.jsxs(u,{variant:"ghost",className:"flex items-center gap-2 h-8 rounded-md",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium hidden md:inline-block",children:c.name}),e.jsx(z,{countryCode:c.countryCode,svg:!0,style:{width:"1.2em",height:"1.2em"}})]})}),e.jsxs(ee,{className:"w-56",align:"end",forceMount:!0,children:[e.jsx(te,{children:b.map(i=>e.jsxs(M,{onClick:()=>t.changeLanguage(i.code),className:"flex items-center gap-2",children:[e.jsx(z,{countryCode:i.countryCode,svg:!0,style:{width:"1.2em",height:"1.2em"}}),e.jsx("span",{children:i.name})]},i.code))}),f&&e.jsxs(e.Fragment,{children:[e.jsx(se,{}),e.jsx(M,{asChild:!0,className:"justify-center text-primary font-semibold cursor-pointer",children:e.jsx("a",{href:route("manage-language"),rel:"noopener noreferrer",children:"Manage Language"})})]})]})]})};function me(){const{t}=A(),{props:s}=_(),[c,l]=j.useState(!1),[k,f]=j.useState(!1),[o,m]=j.useState(!1),{themeColor:i,customColor:I}=O(),g=i==="custom"?I:R[i],n=s.globalSettings||{},p={cookieTitle:n.cookieTitle||"Cookie Consent",cookieDescription:n.cookieDescription||"We use cookies to enhance your browsing experience and provide personalized content.",strictlyCookieTitle:n.strictlyCookieTitle||"Strictly Necessary Cookies",strictlyCookieDescription:n.strictlyCookieDescription||"These cookies are essential for the website to function properly.",contactUsDescription:n.contactUsDescription||"If you have any questions about our cookie policy, please contact us.",contactUsUrl:n.contactUsUrl||"#"};j.useEffect(()=>{var w,x;const a=n.enableLogging==="1"||n.enableLogging===1||n.enableLogging===!0,h=n.is_demo==="1"||n.is_demo===1||n.is_demo===!0,d=window.location.pathname==="/dashboard"||window.location.pathname.includes("/dashboard"),r=(x=(w=s.auth)==null?void 0:w.user)==null?void 0:x.type;if(a){if(h&&(!d||r!=="company"))return;localStorage.getItem("cookie-consent")||l(!0)}},[]);const E=async()=>{try{const a=new AbortController,h=setTimeout(()=>a.abort(),5e3),d=await fetch("https://ipapi.co/json/",{signal:a.signal,headers:{Accept:"application/json"}});if(clearTimeout(h),!d.ok)throw new Error(`HTTP error! status: ${d.status}`);const r=await d.json();return{ip:r.ip||"unknown",country:r.country_name||"unknown",city:r.city||"unknown",region:r.region||"unknown",...r}}catch(a){return console.warn("Failed to get location data:",a.message),{ip:"unknown",country:"unknown",city:"unknown",region:"unknown",error:a.message||"Location fetch failed"}}},C=async(a,h)=>{var d;try{const r=await E(),w={...h,timestamp:new Date().toISOString(),consentType:a,userAgent:navigator.userAgent||"unknown",language:navigator.language||"unknown",url:window.location.href,...r};localStorage.setItem("cookie-consent",JSON.stringify({accepted:!0,timestamp:Date.now()}));const x=(d=document.querySelector('meta[name="csrf-token"]'))==null?void 0:d.getAttribute("content");if(!x){console.warn("CSRF token not found");return}const y=await fetch(route("cookie.consent.store"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":x,Accept:"application/json"},body:JSON.stringify(w)});if(!y.ok)throw new Error(`HTTP error! status: ${y.status}`);if(!(await y.json()).success)throw new Error("Server returned error")}catch(r){throw console.error("Failed to save cookie consent:",r),localStorage.setItem("cookie-consent",JSON.stringify({accepted:!0,timestamp:Date.now()})),r}},N=async()=>{if(!o){m(!0);try{await C("accept_all",{necessary:!0,analytics:!0,marketing:!0}),l(!1)}catch{L.error(t("Failed to save cookie preferences"))}finally{m(!1)}}},S=async()=>{if(!o){m(!0);try{await C("necessary_only",{necessary:!0,analytics:!1,marketing:!1}),l(!1)}catch{L.error(t("Failed to save cookie preferences"))}finally{m(!1)}}};return c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bottom-4 left-4 right-4 z-50 md:left-auto md:max-w-md",children:e.jsxs(D,{className:"p-4 shadow-lg border",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h3",{className:"font-semibold text-sm",children:p.cookieTitle}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>l(!1),className:"h-6 w-6 p-0",children:e.jsx(T,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:p.cookieDescription}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{onClick:N,size:"sm",className:"flex-1 text-white hover:opacity-90",style:{backgroundColor:g},disabled:o,children:t(o?"Saving...":"Accept All")}),e.jsx(u,{onClick:S,variant:"outline",size:"sm",className:"flex-1",style:{borderColor:g,color:g},disabled:o,children:t(o?"Saving...":"Necessary Only")})]}),e.jsx(u,{onClick:()=>f(!0),variant:"ghost",size:"sm",className:"text-sm underline",children:t("Let me choose")})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[p.contactUsDescription," ",e.jsx("a",{href:p.contactUsUrl,className:"underline",children:t("Contact us")})]})]})}),k&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",children:e.jsx(D,{className:"w-full max-w-md max-h-[80vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:p.cookieTitle}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>f(!1),className:"h-6 w-6 p-0",children:e.jsx(T,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm",children:p.strictlyCookieTitle}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:p.strictlyCookieDescription})]}),e.jsx(W,{checked:!0,disabled:!0})]})}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx(u,{onClick:async()=>{await S(),f(!1)},variant:"outline",size:"sm",className:"flex-1",style:{borderColor:g,color:g},disabled:o,children:t(o?"Saving...":"Save Preferences")}),e.jsx(u,{onClick:async()=>{await N(),f(!1)},size:"sm",className:"flex-1 text-white hover:opacity-90",style:{backgroundColor:g},disabled:o,children:t(o?"Saving...":"Accept All")})]})]})})})]}):null}export{me as C,Y as D,ue as L,le as a,Z as b,ee as c,M as d,se as e,de as f,te as g};
